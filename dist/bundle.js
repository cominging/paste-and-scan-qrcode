!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t,n){"use strict";var r=n(1),i=n(2),o=function(){this._initialized=!1,this._wrapEmitterFns()};r(o,i.EventEmitter),o.prototype._wrapEmitterFns=function(){var e=this;["on","once"].forEach((function(t){o.prototype[t]=function(){return e._initialized||e._init(),i.EventEmitter.prototype[t].apply(e,arguments)}}))},o.prototype._clipboardSupported=function(){return window.Clipboard},o.prototype._pasteCatcherFocus=function(){this._pasteCatcher.focus()},o.prototype._listenForClick=function(){var e=this;document.addEventListener("click",(function(){e._pasteCatcherFocus()}))},o.prototype._createPasteCatcherIfNeeded=function(){this._clipboardSupported()||(this._pasteCatcher=document.createElement("div"),this._pasteCatcher.setAttribute("contenteditable",""),this._pasteCatcher.style.opacity=0,this._pasteCatcher.style.position="absolute",document.body.appendChild(this._pasteCatcher),this._pasteCatcher.focus(),this._listenForClick())},o.prototype._listenForPaste=function(){var e=this;window.addEventListener("paste",(function(t){e._pasteHandler(t)}))},o.prototype._init=function(){this._createPasteCatcherIfNeeded(),this._listenForPaste(),this._initialized=!0},o.prototype._checkInputOnNextTick=function(){var e=this;setTimeout((function(){e._checkInput()}),1)},o.prototype._pasteHandler=function(e){if(this.emit("pasting-image",e),e.clipboardData&&e.clipboardData.items){for(var t=e.clipboardData.items,n=0;n<t.length;n++)if(-1!==t[n].type.indexOf("image")){var r=t[n].getAsFile(),i=this._getURLObj().createObjectURL(r);this._createImage(i)}}else this._checkInputOnNextTick()},o.prototype._getURLObj=function(){return window.URL||window.webkitURL},o.prototype._checkInput=function(){var e=this._pasteCatcher.childNodes[0];this._pasteCatcher.innerHTML="",e&&"IMG"===e.tagName&&this._createImage(e.src)},o.prototype._createImage=function(e){var t=this,n=new Image;n.onload=function(){t.emit("paste-image",n)},n.src=e},e.exports=new o},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},function(e,t,n){"use strict";var r,i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,e.exports.once=function(e,t){return new Promise((function(n,r){function i(){void 0!==o&&e.removeListener("error",o),n([].slice.call(arguments))}var o;"error"!==t&&(o=function(n){e.removeListener(t,i),r(n)},e.once("error",o)),e.once(t,i)}))},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var c=10;function h(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function u(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function d(e,t,n,r){var i,o,s,a;if(h(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),s=o[t]),void 0===s)s=o[t]=n,++e._eventsCount;else if("function"==typeof s?s=o[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),(i=u(e))>0&&s.length>i&&!s.warned){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,a=c,console&&console.warn&&console.warn(a)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=l.bind(r);return i.listener=n,r.wrapFn=i,i}function f(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):v(i,i.length)}function m(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function v(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return u(this)},a.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=i[e];if(void 0===c)return!1;if("function"==typeof c)o(c,this,t);else{var h=c.length,u=v(c,h);for(n=0;n<h;++n)o(u[n],this,t)}return!0},a.prototype.addListener=function(e,t){return d(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return d(this,e,t,!0)},a.prototype.once=function(e,t){return h(t),this.on(e,p(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return h(t),this.prependListener(e,p(this,e,t)),this},a.prototype.removeListener=function(e,t){var n,r,i,o,s;if(h(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},a.prototype.listeners=function(e){return f(this,e,!0)},a.prototype.rawListeners=function(e){return f(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},a.prototype.listenerCount=m,a.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t,n){"use strict";n.r(t);class r{static hasCamera(){return navigator.mediaDevices?navigator.mediaDevices.enumerateDevices().then(e=>e.some(e=>"videoinput"===e.kind)).catch(()=>!1):Promise.resolve(!1)}constructor(e,t,n=this._onDecodeError.bind(this),i=r.DEFAULT_CANVAS_SIZE,o="environment"){this.$video=e,this.$canvas=document.createElement("canvas"),this._onDecode=t,this._preferredFacingMode=o,this._active=!1,this._paused=!1,this._flashOn=!1,"number"==typeof n?(i=n,console.warn("You're using a deprecated version of the QrScanner constructor which will be removed in the future")):this._onDecodeError=n,this.$canvas.width=i,this.$canvas.height=i,this._sourceRect={x:0,y:0,width:i,height:i},this._updateSourceRect=this._updateSourceRect.bind(this),this._onPlay=this._onPlay.bind(this),this._onVisibilityChange=this._onVisibilityChange.bind(this),this.$video.playsInline=!0,this.$video.muted=!0,this.$video.disablePictureInPicture=!0,this.$video.addEventListener("loadedmetadata",this._updateSourceRect),this.$video.addEventListener("play",this._onPlay),document.addEventListener("visibilitychange",this._onVisibilityChange),this._qrEnginePromise=r.createQrEngine()}hasFlash(){if(!("ImageCapture"in window))return Promise.resolve(!1);const e=this.$video.srcObject?this.$video.srcObject.getVideoTracks()[0]:null;if(!e)return Promise.reject("Camera not started or not available");return new ImageCapture(e).getPhotoCapabilities().then(e=>e.fillLightMode.includes("flash")).catch(e=>(console.warn(e),!1))}isFlashOn(){return this._flashOn}toggleFlash(){return this._setFlash(!this._flashOn)}turnFlashOff(){return this._setFlash(!1)}turnFlashOn(){return this._setFlash(!0)}destroy(){this.$video.removeEventListener("loadedmetadata",this._updateSourceRect),this.$video.removeEventListener("play",this._onPlay),document.removeEventListener("visibilitychange",this._onVisibilityChange),this.stop(),r._postWorkerMessage(this._qrEnginePromise,"close")}start(){if(this._active&&!this._paused)return Promise.resolve();if("https:"!==window.location.protocol&&console.warn("The camera stream is only accessible if the page is transferred via https."),this._active=!0,this._paused=!1,document.hidden)return Promise.resolve();if(clearTimeout(this._offTimeout),this._offTimeout=null,this.$video.srcObject)return this.$video.play(),Promise.resolve();let e=this._preferredFacingMode;return this._getCameraStream(e,!0).catch(()=>(e="environment"===e?"user":"environment",this._getCameraStream())).then(t=>{e=this._getFacingMode(t)||e,this.$video.srcObject=t,this.$video.play(),this._setVideoMirror(e)}).catch(e=>{throw this._active=!1,e})}stop(){this.pause(),this._active=!1}pause(){this._paused=!0,this._active&&(this.$video.pause(),this._offTimeout||(this._offTimeout=setTimeout(()=>{const e=this.$video.srcObject?this.$video.srcObject.getTracks():[];for(const t of e)t.stop();this.$video.srcObject=null,this._offTimeout=null},300)))}static scanImage(e,t=null,n=null,i=null,o=!1,s=!1){const a=n instanceof Worker;let c=Promise.all([n||r.createQrEngine(),r._loadImage(e)]).then(([e,s])=>{let c;return n=e,[i,c]=this._drawToCanvas(s,t,i,o),n instanceof Worker?(a||n.postMessage({type:"inversionMode",data:"both"}),new Promise((e,t)=>{let o,s,a;s=i=>{"qrResult"===i.data.type&&(n.removeEventListener("message",s),n.removeEventListener("error",a),clearTimeout(o),null!==i.data.data?e(i.data.data):t(r.NO_QR_CODE_FOUND))},a=e=>{n.removeEventListener("message",s),n.removeEventListener("error",a),clearTimeout(o);const r=e?e.message||e:"Unknown Error";t("Scanner error: "+r)},n.addEventListener("message",s),n.addEventListener("error",a),o=setTimeout(()=>a("timeout"),1e4);const h=c.getImageData(0,0,i.width,i.height);n.postMessage({type:"decode",data:h},[h.data.buffer])})):new Promise((e,t)=>{const o=setTimeout(()=>t("Scanner error: timeout"),1e4);n.detect(i).then(n=>{n.length?e(n[0].rawValue):t(r.NO_QR_CODE_FOUND)}).catch(e=>t("Scanner error: "+(e.message||e))).finally(()=>clearTimeout(o))})});return t&&s&&(c=c.catch(()=>r.scanImage(e,null,n,i,o))),c=c.finally(()=>{a||r._postWorkerMessage(n,"close")}),c}setGrayscaleWeights(e,t,n,i=!0){r._postWorkerMessage(this._qrEnginePromise,"grayscaleWeights",{red:e,green:t,blue:n,useIntegerApproximation:i})}setInversionMode(e){r._postWorkerMessage(this._qrEnginePromise,"inversionMode",e)}static createQrEngine(e=r.WORKER_PATH){return("BarcodeDetector"in window?BarcodeDetector.getSupportedFormats():Promise.resolve([])).then(t=>-1!==t.indexOf("qr_code")?new BarcodeDetector({formats:["qr_code"]}):new Worker(e))}_onPlay(){this._updateSourceRect(),this._scanFrame()}_onVisibilityChange(){document.hidden?this.pause():this._active&&this.start()}_updateSourceRect(){const e=Math.min(this.$video.videoWidth,this.$video.videoHeight),t=Math.round(2/3*e);this._sourceRect.width=this._sourceRect.height=t,this._sourceRect.x=(this.$video.videoWidth-t)/2,this._sourceRect.y=(this.$video.videoHeight-t)/2}_scanFrame(){if(!this._active||this.$video.paused||this.$video.ended)return!1;requestAnimationFrame(()=>{this.$video.readyState<=1?this._scanFrame():this._qrEnginePromise.then(e=>r.scanImage(this.$video,this._sourceRect,e,this.$canvas,!0)).then(this._onDecode,e=>{if(!this._active)return;-1!==(e.message||e).indexOf("service unavailable")&&(this._qrEnginePromise=r.createQrEngine()),this._onDecodeError(e)}).then(()=>this._scanFrame())})}_onDecodeError(e){e!==r.NO_QR_CODE_FOUND&&console.log(e)}_getCameraStream(e,t=!1){const n=[{width:{min:1024}},{width:{min:768}},{}];return e&&(t&&(e={exact:e}),n.forEach(t=>t.facingMode=e)),this._getMatchingCameraStream(n)}_getMatchingCameraStream(e){return navigator.mediaDevices&&0!==e.length?navigator.mediaDevices.getUserMedia({video:e.shift()}).catch(()=>this._getMatchingCameraStream(e)):Promise.reject("Camera not found.")}_setFlash(e){return this.hasFlash().then(t=>t?this.$video.srcObject.getVideoTracks()[0].applyConstraints({advanced:[{torch:e}]}):Promise.reject("No flash available")).then(()=>this._flashOn=e)}_setVideoMirror(e){const t="user"===e?-1:1;this.$video.style.transform="scaleX("+t+")"}_getFacingMode(e){const t=e.getVideoTracks()[0];return t?/rear|back|environment/i.test(t.label)?"environment":/front|user|face/i.test(t.label)?"user":null:null}static _drawToCanvas(e,t=null,n=null,r=!1){n=n||document.createElement("canvas");const i=t&&t.x?t.x:0,o=t&&t.y?t.y:0,s=t&&t.width?t.width:e.width||e.videoWidth,a=t&&t.height?t.height:e.height||e.videoHeight;r||n.width===s&&n.height===a||(n.width=s,n.height=a);const c=n.getContext("2d",{alpha:!1});return c.imageSmoothingEnabled=!1,c.drawImage(e,i,o,s,a,0,0,n.width,n.height),[n,c]}static _loadImage(e){if(e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||window.ImageBitmap&&e instanceof window.ImageBitmap||window.OffscreenCanvas&&e instanceof window.OffscreenCanvas)return Promise.resolve(e);if(e instanceof Image)return r._awaitImageLoad(e).then(()=>e);if(e instanceof File||e instanceof Blob||e instanceof URL||"string"==typeof e){const t=new Image;return e instanceof File||e instanceof Blob?t.src=URL.createObjectURL(e):t.src=e,r._awaitImageLoad(t).then(()=>((e instanceof File||e instanceof Blob)&&URL.revokeObjectURL(t.src),t))}return Promise.reject("Unsupported image type.")}static _awaitImageLoad(e){return new Promise((t,n)=>{if(e.complete&&0!==e.naturalWidth)t();else{let r,i;r=()=>{e.removeEventListener("load",r),e.removeEventListener("error",i),t()},i=()=>{e.removeEventListener("load",r),e.removeEventListener("error",i),n("Image load error")},e.addEventListener("load",r),e.addEventListener("error",i)}})}static _postWorkerMessage(e,t,n){return Promise.resolve(e).then(e=>{e instanceof Worker&&e.postMessage({type:t,data:n})})}}r.DEFAULT_CANVAS_SIZE=400,r.NO_QR_CODE_FOUND="No QR code found",r.WORKER_PATH="qr-scanner-worker.min.js";var i=n(0),o=n.n(i);r.WORKER_PATH="qr-scanner-worker.min.js";const s=document.getElementById("pasted-image-qr-result"),a=document.getElementById("qr-video"),c=document.getElementById("cam-has-camera"),h=document.getElementById("cam-qr-result"),u=document.getElementById("cam-qr-result-timestamp"),d=document.getElementById("file-selector"),l=document.getElementById("file-qr-result");function p(e,t){e.textContent=t,u.textContent=(new Date).toString(),e.style.color="teal",clearTimeout(e.highlightTimeout),e.highlightTimeout=setTimeout(()=>e.style.color="inherit",100)}o.a.on("paste-image",(function(e){document.getElementById("pastedImage").innerHTML="",document.getElementById("pastedImage").append(e),r.scanImage(e).then(e=>p(s,e)).catch(e=>p(s,e||"No QR code found."))})),r.hasCamera().then(e=>{c.textContent=e});const f=new r(a,e=>p(h,e));f.start().catch(e=>{a.style.display="none",a.after(document.createTextNode("Error: "+e))}),document.getElementById("inversion-mode-select").addEventListener("change",e=>{f.setInversionMode(e.target.value)}),d.addEventListener("change",e=>{const t=d.files[0];t&&r.scanImage(t).then(e=>p(l,e)).catch(e=>p(l,e||"No QR code found."))})}]);